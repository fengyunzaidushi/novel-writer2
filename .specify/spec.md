# Novel Writer Spec - AI 小说创作命令规范

本文件定义了 Novel Writer 支持的所有斜杠命令。
在 Claude Code、Cursor 或其他 AI 助手中使用这些命令进行小说创作。

## /chapters

---
description: 将章节规划分解为具体的写作任务
scripts:
  sh: .specify/scripts/bash/generate-tasks.sh
  ps: .specify/scripts/powershell/generate-tasks.ps1
---

**重要**：生成日期时，请先运行 `date '+%Y-%m-%d'` 获取当前系统日期，不要手动生成或猜测日期。

基于章节规划生成可执行的写作任务：

1. 运行脚本 `{SCRIPT}` 检查前置条件
2. 加载章节规划 `stories/*/outline.md`
3. 生成任务列表，包括：
   - **章节写作任务**：每章的具体写作任务
   - **角色完善任务**：深化角色设定
   - **世界观补充**：完善世界观细节
   - **修订任务**：已完成章节的修改
4. 按优先级排序任务：
   - 高优先级：开篇章节、主要角色设定
   - 中优先级：正常章节推进
   - 低优先级：补充设定、修订润色
5. 将任务写入 `stories/*/tasks.md`
6. 生成写作进度追踪文件

任务管理：
- 每个任务应有明确的完成标准
- 标记依赖关系（如某章依赖角色设定）
- 估算每个任务的预计字数和时间
- 可以根据实际情况调整任务优先级

## /outline

---
description: 规划详细的章节结构和情节安排
scripts:
  sh: .specify/scripts/bash/setup-outline.sh
  ps: .specify/scripts/powershell/setup-outline.ps1
---

基于已创建的故事大纲，制定详细的章节规划：

1. 运行脚本 `{SCRIPT}` 初始化章节规划文件
2. 加载故事大纲 `stories/*/story.md` 理解故事内容
3. 加载 `.specify/templates/outline-template.md` 理解规划格式
4. 创建章节规划，包含：
   - **总体结构**：总章节数、每章字数、更新计划
   - **卷/部划分**：如有多卷，划分各卷主题
   - **详细章节**：每章的主要事件、角色发展、情节功能
   - **节奏控制**：高潮分布、悬念设置、情感曲线
5. 将规划写入 `stories/*/outline.md`
6. 创建章节文件夹结构 `stories/*/chapters/`

规划原则：
- 每章应有明确的目标和冲突
- 注意节奏的张弛有度
- 伏笔和回收要标记清楚
- 高潮要合理分布，不能都挤在最后

## /plot-check

---
name: plot-check
description: 检查情节发展的一致性和连贯性
scripts:
  sh: .specify/scripts/bash/check-plot.sh
---

# 检查情节发展

分析当前章节与大纲的对齐情况，验证情节发展的连贯性。

## 检查内容

1. **情节节点对齐** - 验证当前进度与大纲规划是否一致
2. **伏笔追踪** - 检查已埋设的伏笔和回收计划
3. **冲突发展** - 确认冲突升级符合预期节奏
4. **角色成长** - 验证角色发展与规划一致

## 使用方法

执行脚本 {SCRIPT}，将会：
- 读取 `spec/tracking/plot-tracker.json`
- 对比 `outline.md` 中的规划
- 分析已写章节内容
- 生成一致性报告

## 输出示例

```
✅ 情节发展检查报告
━━━━━━━━━━━━━━━━━━━━
📍 当前进度：第61章（第二卷）
📊 对齐状态：与大纲一致

⚠️ 待处理伏笔：
  - 青铜古镜的秘密（第2章埋设）
  - 东厂的真实目的（第9章埋设）

✓ 已完成节点：
  - 科举及第 ✓
  - 获得改革传承 ✓

→ 下一个节点：组建改革派系

💡 建议：第65章前需要引入新的冲突点
```

## /relations

---
name: relations
description: 管理和追踪角色关系变化
scripts:
  sh: .specify/scripts/bash/manage-relations.sh
---

# 角色关系管理

追踪和管理角色之间的关系动态，确保关系发展的合理性。

## 功能

1. **关系网络** - 维护角色之间的关系图谱
2. **关系变化** - 记录关系的演变历程
3. **派系管理** - 追踪各势力派系的对立与合作
4. **情感追踪** - 管理角色间的情感发展

## 使用方法

执行脚本 {SCRIPT} [操作] [参数]：
- `update` - 更新角色关系
- `show` - 显示关系网络
- `history` - 查看关系变化历史
- `check` - 验证关系逻辑

## 数据存储

关系数据存储在 `spec/tracking/relationships.json`：
```json
{
  "characters": {
    "主角": {
      "盟友": ["角色A", "角色B"],
      "敌对": ["角色C"],
      "爱慕": ["角色D"],
      "未知": ["角色E"]
    }
  },
  "factions": {
    "改革派": ["主角", "角色A"],
    "保守派": ["角色C", "角色F"]
  }
}
```

## 输出示例

```
👥 角色关系网络
━━━━━━━━━━━━━━━━━━━━
主角：李中庸
├─ 💕 爱慕：沈玉卿
├─ 🤝 盟友：张居正（隐藏）
├─ 📚 导师：利玛窦
├─ ⚔️ 敌对：申时行派系
└─ 👁️ 监视：东厂

派系对立：
改革派 ←→ 保守派
东林党 ←→ 阉党

最近变化（第60章）：
- 沈玉卿：陌生人 → 相互吸引
- 张居正：未知 → 师承关系
```

## /story

---
description: 创建故事大纲，包括主题、角色、世界观等核心设定
scripts:
  sh: .specify/scripts/bash/create-new-story.sh --json "{ARGS}"
  ps: .specify/scripts/powershell/create-new-story.ps1 -Json "{ARGS}"
---

**重要**：生成日期时，请先运行 `date '+%Y-%m-%d'` 获取当前系统日期，不要手动生成或猜测日期。

根据提供的故事描述创建完整的故事大纲：

1. 运行脚本 `{SCRIPT}` 并解析 JSON 输出，获取 STORY_NAME 和 STORY_FILE
   **重要**：脚本只运行一次，JSON 输出会显示在终端
2. 加载 `.specify/templates/story-template.md` 理解所需章节
3. 使用模板结构将故事大纲写入 STORY_FILE，包含：
   - **故事概述**：一句话描述、核心冲突、主题思想
   - **角色设定**：主角和重要配角的详细设定
   - **世界观**：时代背景、地理环境、特殊规则
   - **情节大纲**：三幕结构或起承转合
4. 报告完成，包含故事名称、文件路径，准备进入章节规划

创作要点：
- 聚焦于"是什么"和"为什么"，而非"如何写"
- 角色要有明确的动机和成长弧线
- 世界观设定要自洽且有特色
- 情节要有冲突和张力

## /style

---
description: 设定小说创作风格和准则，建立创作的基本原则
scripts:
  sh: .specify/scripts/bash/setup-style.sh
  ps: .specify/scripts/powershell/setup-style.ps1
---

根据提供的创作风格描述，执行以下操作：

1. 运行脚本 `{SCRIPT}` 创建或更新创作风格文件
2. 加载 `.specify/memory/writing-constitution.md` 模板，理解所需的章节
3. 根据用户描述填充以下内容：
   - 叙事视角（第一人称/第三人称等）
   - 文字风格（简洁明快/华丽优美等）
   - 创作原则（角色塑造、情节推进等）
   - 质量标准（字数要求、更新频率等）
4. 将创作准则写入 `.specify/memory/writing-constitution.md`
5. 报告完成状态，准备进入下一阶段

注意事项：
- 创作风格应当贯穿整个作品
- 可以参考知名作品的风格，但要形成自己的特色
- 风格设定后可以调整，但要保持一致性

## /timeline

---
name: timeline
description: 管理和验证故事时间线
scripts:
  sh: .specify/scripts/bash/check-timeline.sh
---

# 时间线管理

维护故事的时间轴，确保时间逻辑的一致性。

## 功能

1. **时间记录** - 追踪每个章节的时间点
2. **并行事件** - 管理同时发生的多线剧情
3. **历史对照** - 与真实历史事件对比（历史小说）
4. **逻辑验证** - 检查时间跨度的合理性

## 使用方法

执行脚本 {SCRIPT}，支持以下操作：
- `add` - 添加时间节点
- `check` - 验证时间连续性
- `show` - 显示时间线概览
- `sync` - 同步并行事件

## 时间线数据

时间线信息存储在 `spec/tracking/timeline.json` 中：
- 故事内时间（年/月/日）
- 章节对应关系
- 重要事件标记
- 时间跨度计算

## 示例输出

```
📅 故事时间线
━━━━━━━━━━━━━━━━━━━━
当前时间：万历三十年春

第1章  | 万历二十九年冬月 | 穿越事件
第4章  | 万历三十年正月   | 北上赴考
第6章  | 万历三十年二月   | 会试
第8章  | 万历三十年三月   | 殿试
第61章 | 万历三十年四月   | [待写]

⏱️ 时间跨度：5个月
🔄 并行事件：日本入侵朝鲜
```

## /track

---
name: track
description: 综合追踪小说创作进度和内容
scripts:
  sh: .specify/scripts/bash/track-progress.sh
---

# 综合进度追踪

全面展示小说创作的各项进度和状态。

## 追踪维度

1. **写作进度** - 字数、章节、完成率
2. **情节发展** - 主线进度、支线状态
3. **时间线** - 故事时间推进
4. **角色状态** - 角色发展和位置
5. **伏笔管理** - 埋设和回收状态

## 使用方法

执行脚本 {SCRIPT} [选项]：
- 无参数 - 显示完整追踪报告
- `--brief` - 显示简要信息
- `--plot` - 仅显示情节追踪
- `--stats` - 仅显示统计数据
- `--check` - 执行一致性检查

## 数据来源

整合多个追踪文件的信息：
- `progress.json` - 写作进度
- `spec/tracking/plot-tracker.json` - 情节追踪
- `spec/tracking/timeline.json` - 时间线
- `spec/tracking/relationships.json` - 关系网络
- `spec/tracking/character-state.json` - 角色状态

## 输出示例

```
📊 小说创作综合报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📖 《大明风华录》

✍️ 写作进度
  完成：60/240章 (25%)
  字数：162,000/800,000
  当前：第二卷《朝堂风云》

📍 情节状态
  主线：改革大业 [朝堂初入阶段]
  支线：感情线 [相互了解]

⏰ 时间线
  故事时间：万历三十年春
  时间跨度：5个月

👥 主要角色
  李中庸：翰林院编修 @北京
  沈玉卿：张居正义女 [活跃]

⚡ 待处理
  伏笔：3个未回收
  冲突：改革vs保守 [升级中]

✅ 一致性检查：通过
```

## /world-check

---
name: world-check
description: 验证世界观设定的一致性
scripts:
  sh: .specify/scripts/bash/check-world.sh
---

# 世界观一致性检查

确保故事中的世界观设定保持前后一致，避免矛盾和冲突。

## 检查范围

1. **设定一致性** - 验证规则、法则、体系的一致
2. **地理逻辑** - 检查地点、距离、方位的合理性
3. **文化连贯** - 确保风俗、语言、传统的统一
4. **科技/魔法水平** - 验证能力范围和限制

## 使用方法

执行脚本 {SCRIPT}，将会：
- 扫描 `spec/knowledge/world-setting.md`
- 分析已写章节中的设定描述
- 对比查找矛盾和冲突
- 生成一致性报告

## 知识库结构

世界观设定存储在 `spec/knowledge/` 目录：
- `world-setting.md` - 核心世界观
- `locations.md` - 地点描述
- `culture.md` - 文化风俗
- `rules.md` - 特殊规则

## 输出示例

```
🌍 世界观一致性报告
━━━━━━━━━━━━━━━━━━━━
✅ 检查通过：23项
⚠️ 潜在问题：2项

⚠️ 发现的问题：
1. 第15章提到"三日路程"，但按地图应为五日
2. 第23章的官职名称与第3章不一致

📚 设定统计：
- 地点：15个
- 组织：8个
- 特殊规则：5条
- 专有名词：47个

💡 建议创建术语表以保持一致性
```

## /write

---
description: 执行具体的章节写作，AI 辅助创作内容
scripts:
  sh: .specify/scripts/bash/write-chapter.sh
  ps: .specify/scripts/powershell/write-chapter.ps1
---

执行章节写作任务：

1. 运行脚本 `{SCRIPT}` 确定要写作的章节
2. 加载相关文件：
   - 创作风格：`.specify/memory/writing-constitution.md`
   - 故事大纲：`stories/*/story.md`
   - 章节规划：`stories/*/outline.md`
   - 前文内容：`stories/*/chapters/` (如有)
3. 根据章节大纲创作内容：
   - **开场**：吸引读者，承接前文
   - **发展**：推进情节，深化人物
   - **转折**：制造冲突或悬念
   - **收尾**：适当收束，引出下文
4. 确保内容符合：
   - 设定的创作风格
   - 角色性格一致性
   - 世界观规则
   - 情节逻辑
5. 将章节内容写入对应文件
6. 更新写作进度和任务状态

写作要点：
- 保持风格一致性
- 注意伏笔的埋设和回收
- 对话要符合角色身份
- 描写要有画面感
- 每章要有明确的推进作用

